import { __decorate, __metadata } from "tslib";
import { Component, EventEmitter, Output, ElementRef, Renderer2, } from "@angular/core";
import { DIRECTIONS } from "../misc/picker-directions";
import { Subject } from "rxjs";
import { takeUntil, debounceTime } from "rxjs/operators";
let EmojiPickerComponent = class EmojiPickerComponent {
    constructor(_renderer, _el) {
        this._renderer = _renderer;
        this._el = _el;
        this.selectionEmitter = new EventEmitter();
        this.pickerCloseEmitter = new EventEmitter();
        this._windowResize = new Subject();
        this._destroyed = new Subject();
        this._windowResize
            .pipe(takeUntil(this._destroyed), debounceTime(100))
            .subscribe((event) => {
            this.setPosition(this._currentTarget, this._currentDirection);
        });
    }
    setPosition(target, directionCode = DIRECTIONS.bottom) {
        if (!target) {
            return console.error("Emoji-Picker: positioning failed due to missing target element or direction code");
        }
        this._renderer.setStyle(this._el.nativeElement, "transform", "");
        /** Store anchor and direction */
        this._currentTarget = target;
        this._currentDirection = directionCode;
        const targetBorders = target.nativeElement.getBoundingClientRect(), thisBorders = this._el.nativeElement.getBoundingClientRect();
        let heightCorrection = 0, widthCorrection = 0;
        /** Setting up centering of picker for all cases */
        switch (this._currentDirection) {
            case DIRECTIONS.top:
            case DIRECTIONS.bottom:
                widthCorrection =
                    targetBorders.left -
                        thisBorders.left +
                        (targetBorders.width - thisBorders.width) / 2;
                break;
            case DIRECTIONS.left:
            case DIRECTIONS.right:
                heightCorrection =
                    targetBorders.top -
                        thisBorders.top +
                        (targetBorders.height - thisBorders.height) / 2;
                break;
        }
        /** Setting up relative positioning for all cases */
        switch (this._currentDirection) {
            case DIRECTIONS.top:
                heightCorrection = targetBorders.top - thisBorders.bottom;
                break;
            case DIRECTIONS.left:
                widthCorrection = targetBorders.left - thisBorders.right;
                break;
            case DIRECTIONS.right:
                widthCorrection = targetBorders.right - thisBorders.left;
                break;
            case DIRECTIONS.bottom:
                heightCorrection = targetBorders.bottom - thisBorders.top;
                break;
        }
        /** Correcting positioning due to overflow problems */
        if (thisBorders.bottom + heightCorrection > window.innerHeight) {
            heightCorrection +=
                window.innerHeight - (thisBorders.bottom + heightCorrection);
        }
        if (thisBorders.top + heightCorrection < 0) {
            heightCorrection -= thisBorders.top + heightCorrection;
        }
        if (thisBorders.right + widthCorrection > window.innerWidth) {
            widthCorrection +=
                window.innerWidth - (thisBorders.right + widthCorrection);
        }
        if (thisBorders.left + widthCorrection < 0) {
            widthCorrection -= thisBorders.left + widthCorrection;
        }
        /** set the position adjustments to the emoji picker element */
        this._renderer.setStyle(this._el.nativeElement, "transform", `translate(${widthCorrection}px,${heightCorrection}px)`);
    }
    onBackground(event) {
        /** internal mousedowns are ignored */
        if (event === this._lastHostMousedownEvent || event.emojiPickerExempt) {
            return;
        }
        this.pickerCloseEmitter.emit(event);
    }
    ngOnDestroy() {
        this._destroyed.next(true);
    }
};
EmojiPickerComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: ElementRef }
];
__decorate([
    Output("emoji-select"),
    __metadata("design:type", Object)
], EmojiPickerComponent.prototype, "selectionEmitter", void 0);
__decorate([
    Output("picker-close"),
    __metadata("design:type", Object)
], EmojiPickerComponent.prototype, "pickerCloseEmitter", void 0);
EmojiPickerComponent = __decorate([
    Component({
        selector: "emoji-picker",
        template: `
    <emoji-content
      (emoji-selection)="selectionEmitter.emit($event)"
    ></emoji-content>
  `,
        host: {
            "(document:click)": "onBackground($event)",
            "(click)": "_lastHostMousedownEvent = $event",
            "(window:resize)": "_windowResize.next($event)",
        },
        styles: [":host { position: absolute; z-index: 9999; }"]
    }),
    __metadata("design:paramtypes", [Renderer2, ElementRef])
], EmojiPickerComponent);
export { EmojiPickerComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW1vamktcGlja2VyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1lbW9qaS1waWNrZXIvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9lbW9qaS1waWNrZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULFlBQVksRUFDWixNQUFNLEVBQ04sVUFBVSxFQUNWLFNBQVMsR0FDVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDdkQsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBZ0J6RCxJQUFhLG9CQUFvQixHQUFqQyxNQUFhLG9CQUFvQjtJQVcvQixZQUFvQixTQUFvQixFQUFVLEdBQWU7UUFBN0MsY0FBUyxHQUFULFNBQVMsQ0FBVztRQUFVLFFBQUcsR0FBSCxHQUFHLENBQVk7UUFWekMscUJBQWdCLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUN0Qyx1QkFBa0IsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBTXpELGtCQUFhLEdBQUcsSUFBSSxPQUFPLEVBQU8sQ0FBQztRQUNuQyxlQUFVLEdBQUcsSUFBSSxPQUFPLEVBQVcsQ0FBQztRQUd6QyxJQUFJLENBQUMsYUFBYTthQUNmLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxFQUFFLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQzthQUNuRCxTQUFTLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRTtZQUNuQixJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUM7UUFDaEUsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsV0FBVyxDQUNULE1B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SSxXQUFXLENBQUMsSUFBSSxHQUFHLGVBQWUsQ0FBQztTQUN2RDtRQUVELCtEQUErRDtRQUMvRCxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FDckIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxhQUFhLEVBQ3RCLFdBQVcsRUFDWCxhQUFhLGVBQWUsTUFBTSxnQkFBZ0IsS0FBSyxDQUN4RCxDQUFDO0lBQ0osQ0FBQztJQUVELFlBQVksQ0FBQyxLQUFLO1FBQ2hCLHNDQUFzQztRQUN0QyxJQUFJLEtBQUssS0FBSyxJQUFJLENBQUMsdUJBQXVCLElBQUksS0FBSyxDQUFDLGlCQUFpQixFQUFFO1lBQ3JFLE9BQU87U0FDUjtRQUVELElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDdEMsQ0FBQztJQUVELFdBQVc7UUFDVCxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM3QixDQUFDO0NBQ0YsQ0FBQTs7WUF2R2dDLFNBQVM7WUFBZSxVQUFVOztBQVZ6QztJQUF2QixNQUFNLENBQUMsY0FBYyxDQUFDOzs4REFBdUM7QUFDdEM7SUFBdkIsTUFBTSxDQUFDLGNBQWMsQ0FBQzs7Z0VBQXlDO0FBRnJELG9CQUFvQjtJQWRoQyxTQUFTLENBQUM7UUFDVCxRQUFRLEVBQUUsY0FBYztRQUV4QixRQUFRLEVBQUU7Ozs7R0FJVDtRQUNELElBQUksRUFBRTtZQUNKLGtCQUFrQixFQUFFLHNCQUFzQjtZQUMxQyxTQUFTLEVBQUUsa0NBQWtDO1lBQzdDLGlCQUFpQixFQUFFLDRCQUE0QjtTQUNoRDtpQkFWUSw4Q0FBOEM7S0FXeEQsQ0FBQztxQ0FZK0IsU0FBUyxFQUFlLFVBQVU7R0FYdEQsb0JBQW9CLENBa0hoQztTQWxIWSxvQkFBb0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21wb25lbnQsXG4gIEV2ZW50RW1pdHRlcixcbiAgT3V0cHV0LFxuICBFbGVtZW50UmVmLFxuICBSZW5kZXJlcjIsXG59IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5pbXBvcnQgeyBESVJFQ1RJT05TIH0gZnJvbSBcIi4uL21pc2MvcGlja2VyLWRpcmVjdGlvbnNcIjtcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tIFwicnhqc1wiO1xuaW1wb3J0IHsgdGFrZVVudGlsLCBkZWJvdW5jZVRpbWUgfSBmcm9tIFwicnhqcy9vcGVyYXRvcnNcIjtcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiBcImVtb2ppLXBpY2tlclwiLFxuICBzdHlsZXM6IFtcIjpob3N0IHsgcG9zaXRpb246IGFic29sdXRlOyB6LWluZGV4OiA5OTk5OyB9XCJdLFxuICB0ZW1wbGF0ZTogYFxuICAgIDxlbW9qaS1jb250ZW50XG4gICAgICAoZW1vamktc2VsZWN0aW9uKT1cInNlbGVjdGlvbkVtaXR0ZXIuZW1pdCgkZXZlbnQpXCJcbiAgICA+PC9lbW9qaS1jb250ZW50PlxuICBgLFxuICBob3N0OiB7XG4gICAgXCIoZG9jdW1lbnQ6Y2xpY2spXCI6IFwib25CYWNrZ3JvdW5kKCRldmVudClcIixcbiAgICBcIihjbGljaylcIjogXCJfbGFzdEhvc3RNb3VzZWRvd25FdmVudCA9ICRldmVudFwiLFxuICAgIFwiKHdpbmRvdzpyZXNpemUpXCI6IFwiX3dpbmRvd1Jlc2l6ZS5uZXh0KCRldmVudClcIixcbiAgfSxcbn0pXG5leHBvcnQgY2xhc3MgRW1vamlQaWNrZXJDb21wb25lbnQge1xuICBAT3V0cHV0KFwiZW1vamktc2VsZWN0XCIpIHNlbGVjdGlvbkVtaXR0ZXIgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIEBPdXRwdXQoXCJwaWNrZXItY2xvc2VcIikgcGlja2VyQ2xvc2VFbWl0dGVyID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIHB1YmxpYyBfbGFzdEhvc3RNb3VzZWRvd25FdmVudDtcbiAgcHVibGljIF9jdXJyZW50VGFyZ2V0OiBFbGVtZW50UmVmO1xuICBwdWJsaWMgX2N1cnJlbnREaXJlY3Rpb246IERJUkVDVElPTlM7XG5cbiAgcHVibGljIF93aW5kb3dSZXNpemUgPSBuZXcgU3ViamVjdDxhbnk+KCk7XG4gIHB1YmxpYyBfZGVzdHJveWVkID0gbmV3IFN1YmplY3Q8Ym9vbGVhbj4oKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIF9yZW5kZXJlcjogUmVuZGVyZXIyLCBwcml2YXRlIF9lbDogRWxlbWVudFJlZikge1xuICAgIHRoaXMuX3dpbmRvd1Jlc2l6ZVxuICAgICAgLnBpcGUodGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3llZCksIGRlYm91bmNlVGltZSgxMDApKVxuICAgICAgLnN1YnNjcmliZSgoZXZlbnQpID0+IHtcbiAgICAgICAgdGhpcy5zZXRQb3NpdGlvbih0aGlzLl9jdXJyZW50VGFyZ2V0LCB0aGlzLl9jdXJyZW50RGlyZWN0aW9uKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgc2V0UG9zaXRpb24oXG4gICAgdGFyZ2V0OiBFbGVtZW50UmVmLFxuICAgIGRpcmVjdGlvbkNvZGU6IERJUkVDVElPTlMgPSBESVJFQ1RJT05TLmJvdHRvbVxuICApIHtcbiAgICBpZiAoIXRhcmdldCkge1xuICAgICAgcmV0dXJuIGNvbnNvbGUuZXJyb3IoXG4gICAgICAgIFwiRW1vamktUGlja2VyOiBwb3NpdGlvbmluZyBmYWlsZWQgZHVlIHRvIG1pc3NpbmcgdGFyZ2V0IGVsZW1lbnQgb3IgZGlyZWN0aW9uIGNvZGVcIlxuICAgICAgKTtcbiAgICB9XG5cbiAgICB0aGlzLl9yZW5kZXJlci5zZXRTdHlsZSh0aGlzLl9lbC5uYXRpdmVFbGVtZW50LCBcInRyYW5zZm9ybVwiLCBcIlwiKTtcblxuICAgIC8qKiBTdG9yZSBhbmNob3IgYW5kIGRpcmVjdGlvbiAqL1xuICAgIHRoaXMuX2N1cnJlbnRUYXJnZXQgPSB0YXJnZXQ7XG4gICAgdGhpcy5fY3VycmVudERpcmVjdGlvbiA9IGRpcmVjdGlvbkNvZGU7XG5cbiAgICBjb25zdCB0YXJnZXRCb3JkZXJzID0gdGFyZ2V0Lm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksXG4gICAgICB0aGlzQm9yZGVycyA9IHRoaXMuX2VsLm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICBsZXQgaGVpZ2h0Q29ycmVjdGlvbiA9IDAsXG4gICAgICB3aWR0aENvcnJlY3Rpb24gPSAwO1xuXG4gICAgLyoqIFNldHRpbmcgdXAgY2VudGVyaW5nIG9mIHBpY2tlciBmb3IgYWxsIGNhc2VzICovXG4gICAgc3dpdGNoICh0aGlzLl9jdXJyZW50RGlyZWN0aW9uKSB7XG4gICAgICBjYXNlIERJUkVDVElPTlMudG9wOlxuICAgICAgY2FzZSBESVJFQ1RJT05TLmJvdHRvbTpcbiAgICAgICAgd2lkdGhDb3JyZWN0aW9uID1cbiAgICAgICAgICB0YXJnZXRCb3JkZXJzLmxlZnQgLVxuICAgICAgICAgIHRoaXNCb3JkZXJzLmxlZnQgK1xuICAgICAgICAgICh0YXJnZXRCb3JkZXJzLndpZHRoIC0gdGhpc0JvcmRlcnMud2lkdGgpIC8gMjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIERJUkVDVElPTlMubGVmdDpcbiAgICAgIGNhc2UgRElSRUNUSU9OUy5yaWdodDpcbiAgICAgICAgaGVpZ2h0Q29ycmVjdGlvbiA9XG4gICAgICAgICAgdGFyZ2V0Qm9yZGVycy50b3AgLVxuICAgICAgICAgIHRoaXNCb3JkZXJzLnRvcCArXG4gICAgICAgICAgKHRhcmdldEJvcmRlcnMuaGVpZ2h0IC0gdGhpc0JvcmRlcnMuaGVpZ2h0KSAvIDI7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIC8qKiBTZXR0aW5nIHVwIHJlbGF0aXZlIHBvc2l0aW9uaW5nIGZvciBhbGwgY2FzZXMgKi9cbiAgICBzd2l0Y2ggKHRoaXMuX2N1cnJlbnREaXJlY3Rpb24pIHtcbiAgICAgIGNhc2UgRElSRUNUSU9OUy50b3A6XG4gICAgICAgIGhlaWdodENvcnJlY3Rpb24gPSB0YXJnZXRCb3JkZXJzLnRvcCAtIHRoaXNCb3JkZXJzLmJvdHRvbTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIERJUkVDVElPTlMubGVmdDpcbiAgICAgICAgd2lkdGhDb3JyZWN0aW9uID0gdGFyZ2V0Qm9yZGVycy5sZWZ0IC0gdGhpc0JvcmRlcnMucmlnaHQ7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBESVJFQ1RJT05TLnJpZ2h0OlxuICAgICAgICB3aWR0aENvcnJlY3Rpb24gPSB0YXJnZXRCb3JkZXJzLnJpZ2h0IC0gdGhpc0JvcmRlcnMubGVmdDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIERJUkVDVElPTlMuYm90dG9tOlxuICAgICAgICBoZWlnaHRDb3JyZWN0aW9uID0gdGFyZ2V0Qm9yZGVycy5ib3R0b20gLSB0aGlzQm9yZGVycy50b3A7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIC8qKiBDb3JyZWN0aW5nIHBvc2l0aW9uaW5nIGR1ZSB0byBvdmVyZmxvdyBwcm9ibGVtcyAqL1xuICAgIGlmICh0aGlzQm9yZGVycy5ib3R0b20gKyBoZWlnaHRDb3JyZWN0aW9uID4gd2luZG93LmlubmVySGVpZ2h0KSB7XG4gICAgICBoZWlnaHRDb3JyZWN0aW9uICs9XG4gICAgICAgIHdpbmRvdy5pbm5lckhlaWdodCAtICh0aGlzQm9yZGVycy5ib3R0b20gKyBoZWlnaHRDb3JyZWN0aW9uKTtcbiAgICB9XG5cbiAgICBpZiAodGhpc0JvcmRlcnMudG9wICsgaGVpZ2h0Q29ycmVjdGlvbiA8IDApIHtcbiAgICAgIGhlaWdodENvcnJlY3Rpb24gLT0gdGhpc0JvcmRlcnMudG9wICsgaGVpZ2h0Q29ycmVjdGlvbjtcbiAgICB9XG5cbiAgICBpZiAodGhpc0JvcmRlcnMucmlnaHQgKyB3aWR0aENvcnJlY3Rpb24gPiB3aW5kb3cuaW5uZXJXaWR0aCkge1xuICAgICAgd2lkdGhDb3JyZWN0aW9uICs9XG4gICAgICAgIHdpbmRvdy5pbm5lcldpZHRoIC0gKHRoaXNCb3JkZXJzLnJpZ2h0ICsgd2lkdGhDb3JyZWN0aW9uKTtcbiAgICB9XG5cbiAgICBpZiAodGhpc0JvcmRlcnMubGVmdCArIHdpZHRoQ29ycmVjdGlvbiA8IDApIHtcbiAgICAgIHdpZHRoQ29ycmVjdGlvbiAtPSB0aGlzQm9yZGVycy5sZWZ0ICsgd2lkdGhDb3JyZWN0aW9uO1xuICAgIH1cblxuICAgIC8qKiBzZXQgdGhlIHBvc2l0aW9uIGFkanVzdG1lbnRzIHRvIHRoZSBlbW9qaSBwaWNrZXIgZWxlbWVudCAqL1xuICAgIHRoaXMuX3JlbmRlcmVyLnNldFN0eWxlKFxuICAgICAgdGhpcy5fZWwubmF0aXZlRWxlbWVudCxcbiAgICAgIFwidHJhbnNmb3JtXCIsXG4gICAgICBgdHJhbnNsYXRlKCR7d2lkdGhDb3JyZWN0aW9ufXB4LCR7aGVpZ2h0Q29ycmVjdGlvbn1weClgXG4gICAgKTtcbiAgfVxuXG4gIG9uQmFja2dyb3VuZChldmVudCkge1xuICAgIC8qKiBpbnRlcm5hbCBtb3VzZWRvd25zIGFyZSBpZ25vcmVkICovXG4gICAgaWYgKGV2ZW50ID09PSB0aGlzLl9sYXN0SG9zdE1vdXNlZG93bkV2ZW50IHx8IGV2ZW50LmVtb2ppUGlja2VyRXhlbXB0KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5waWNrZXJDbG9zZUVtaXR0ZXIuZW1pdChldmVudCk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLl9kZXN0cm95ZWQubmV4dCh0cnVlKTtcbiAgfVxufVxuIl19